[Unit]
Description=RabbitMQ message broker

Requires=etcd.service
After=etcd.service

Requires=docker.service
After=docker.service

Requires=rabbitmq-registrator@%i.service
Before=rabbitmq-registrator@%i.service

[Service]
TimeoutStartSec=0
KillMode=none
EnvironmentFile=/etc/metadata

ExecStartPre=-/usr/bin/docker kill rabbitmq
ExecStartPre=-/usr/bin/docker rm rabbitmq
ExecStartPre=/usr/bin/docker pull bachelorthesis/rabbitmq

ExecStart=/usr/bin/docker run --rm --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  bachelorthesis/rabbitmq
  
ExecStop=/usr/bin/docker stop rabbitmq

[X-Fleet]
Conflicts=rabbitmq@*.service
